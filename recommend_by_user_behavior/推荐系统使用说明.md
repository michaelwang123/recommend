# æ¨èç³»ç»Ÿä½¿ç”¨è¯´æ˜

## ç³»ç»Ÿæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºMySQLæ•°æ®çš„æ¨èç³»ç»Ÿï¼Œä½¿ç”¨çŸ©é˜µåˆ†è§£ç®—æ³•ä¸ºç”¨æˆ·ç”Ÿæˆä¸ªæ€§åŒ–æ¨èã€‚ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†éè¿ç»­çš„ç”¨æˆ·IDå’Œç‰©å“IDï¼Œæ”¯æŒå¤šç§ç”¨æˆ·ç±»å‹ï¼Œå¹¶æä¾›å®Œæ•´çš„è®­ç»ƒã€æ¨èå’Œè¯„ä¼°åŠŸèƒ½ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ ä¸»è¦åŠŸèƒ½
- **æ™ºèƒ½IDæ˜ å°„**ï¼šè‡ªåŠ¨å¤„ç†éè¿ç»­çš„ç”¨æˆ·IDå’Œç‰©å“ID
- **çŸ©é˜µåˆ†è§£æ¨è**ï¼šåŸºäºPyTorchçš„æ·±åº¦å­¦ä¹ æ¨èæ¨¡å‹
- **å¤šç”¨æˆ·ç±»å‹æ”¯æŒ**ï¼šæ”¯æŒä¸åŒç±»å‹ç”¨æˆ·çš„ä¸ªæ€§åŒ–æ¨è
- **ç”¨æˆ·ç¾¤ä½“åˆ†æ**ï¼šåˆ†æä¸åŒç”¨æˆ·ç¾¤ä½“çš„ç‰¹å¾å’Œç›¸ä¼¼åº¦
- **æ¨¡å‹æŒä¹…åŒ–**ï¼šæ”¯æŒæ¨¡å‹å’Œé…ç½®çš„ä¿å­˜ä¸åŠ è½½
- **MySQLæ•°æ®æº**ï¼šç›´æ¥ä»MySQLæ•°æ®åº“åŠ è½½ç”¨æˆ·è¡Œä¸ºæ•°æ®

### ğŸ—ï¸ æŠ€æœ¯æ¶æ„
- **æ·±åº¦å­¦ä¹ æ¡†æ¶**ï¼šPyTorch
- **æ•°æ®åº“**ï¼šMySQL
- **ç®—æ³•**ï¼šçŸ©é˜µåˆ†è§£ï¼ˆMatrix Factorizationï¼‰
- **ç¼–ç¨‹è¯­è¨€**ï¼šPython 3

## ç¯å¢ƒè¦æ±‚

### ä¾èµ–åŒ…
```bash
pip install mysql-connector-python
pip install torch
pip install numpy
pip install pandas
pip install scikit-learn
```

### æ•°æ®åº“è¡¨ç»“æ„
```sql
CREATE TABLE user_behavior (
    user_id INT,
    item_id INT,
    rating FLOAT,
    user_type VARCHAR(50),
    item_category VARCHAR(50),
    created_at TIMESTAMP
);
```

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨
```python
from recommend import MySQLRecommendationSystem

# åˆ›å»ºæ¨èç³»ç»Ÿå®ä¾‹
recommender = MySQLRecommendationSystem()

# è¿è¡Œå®Œæ•´æµç¨‹
success = recommender.run_complete_pipeline()

if success:
    print("æ¨èç³»ç»Ÿæ„å»ºæˆåŠŸ!")
```

### 2. è‡ªå®šä¹‰æ•°æ®åº“é…ç½®
```python
# é…ç½®æ•°æ®åº“è¿æ¥
db_config = {
    'host': 'localhost',
    'port': 3306,
    'user': 'your_username',
    'password': 'your_password',
    'database': 'your_database'
}

# åˆ›å»ºæ¨èç³»ç»Ÿå®ä¾‹
recommender = MySQLRecommendationSystem(db_config=db_config)
```

## è¯¦ç»†ä½¿ç”¨æ–¹æ³•

### 1. æ•°æ®åŠ è½½å’Œé¢„å¤„ç†

#### ä»MySQLåŠ è½½æ•°æ®
```python
# ä»MySQLåŠ è½½ç”¨æˆ·è¡Œä¸ºæ•°æ®
df = recommender.load_data_from_mysql()

# æŸ¥çœ‹æ•°æ®ç»Ÿè®¡
print(f"æ•°æ®è®°å½•æ•°: {len(df)}")
print(f"å”¯ä¸€ç”¨æˆ·æ•°: {df['user_id'].nunique()}")
print(f"å”¯ä¸€ç‰©å“æ•°: {df['item_id'].nunique()}")
```

#### åˆ›å»ºIDæ˜ å°„
```python
# åˆ›å»ºéè¿ç»­IDåˆ°è¿ç»­ç´¢å¼•çš„æ˜ å°„
recommender.create_id_mappings(df)

# æŸ¥çœ‹æ˜ å°„ç»“æœ
print(f"ç”¨æˆ·æ˜ å°„æ•°é‡: {recommender.num_users}")
print(f"ç‰©å“æ˜ å°„æ•°é‡: {recommender.num_items}")
```

### 2. æ¨¡å‹è®­ç»ƒ

#### åŸºç¡€è®­ç»ƒ
```python
# å‡†å¤‡è®­ç»ƒæ•°æ®
df_train = recommender.prepare_training_data(df)

# è®­ç»ƒæ¨¡å‹
training_result = recommender.train_model(df_train)
```

#### è‡ªå®šä¹‰è®­ç»ƒå‚æ•°
```python
# è‡ªå®šä¹‰è®­ç»ƒå‚æ•°
training_result = recommender.train_model(
    df_train,
    epochs=200,           # è®­ç»ƒè½®æ•°
    learning_rate=0.005,  # å­¦ä¹ ç‡
    test_size=0.2         # éªŒè¯é›†æ¯”ä¾‹
)
```

### 3. ç”Ÿæˆæ¨è

#### ä¸ºç”¨æˆ·ç”Ÿæˆæ¨è
```python
# ä¸ºæŒ‡å®šç”¨æˆ·ç”Ÿæˆæ¨è
user_id = 1001
recommendations = recommender.get_user_recommendations(
    user_id=user_id,
    top_n=10,           # æ¨èæ•°é‡
    exclude_rated=True,  # æ’é™¤å·²è¯„åˆ†ç‰©å“
    df=df               # åŸå§‹æ•°æ®ç”¨äºæ’é™¤å·²è¯„åˆ†ç‰©å“
)

# æŸ¥çœ‹æ¨èç»“æœ
for rec in recommendations:
    print(f"æ’å: {rec['rank']}, ç‰©å“ID: {rec['item_id']}, é¢„æµ‹è¯„åˆ†: {rec['predicted_rating']:.2f}")
```

#### æ‰¹é‡ç”Ÿæˆæ¨è
```python
# ä¸ºå¤šä¸ªç”¨æˆ·ç”Ÿæˆæ¨è
user_ids = [1001, 1002, 1003]
all_recommendations = {}

for user_id in user_ids:
    if user_id in recommender.user_id_to_idx:
        recommendations = recommender.get_user_recommendations(user_id, top_n=5, df=df)
        all_recommendations[user_id] = recommendations
```

### 4. ç”¨æˆ·ç¾¤ä½“åˆ†æ

```python
# åˆ†æä¸åŒç”¨æˆ·ç¾¤ä½“çš„ç‰¹å¾
recommender.analyze_user_groups(df)

# æ¼”ç¤ºæ¨èæ•ˆæœ
recommender.demonstrate_recommendations(df)
```

### 5. æ¨¡å‹ä¿å­˜å’ŒåŠ è½½

#### ä¿å­˜æ¨¡å‹
```python
# ä¿å­˜æ¨¡å‹å’Œæ˜ å°„
success = recommender.save_model_and_mappings(save_dir="./my_model")

if success:
    print("æ¨¡å‹ä¿å­˜æˆåŠŸ!")
```

#### åŠ è½½æ¨¡å‹
```python
# åˆ›å»ºæ–°çš„æ¨èç³»ç»Ÿå®ä¾‹
new_recommender = MySQLRecommendationSystem()

# åŠ è½½å·²ä¿å­˜çš„æ¨¡å‹
success = new_recommender.load_model_and_mappings(save_dir="./my_model")

if success:
    print("æ¨¡å‹åŠ è½½æˆåŠŸ!")
    # ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨æ¨¡å‹è¿›è¡Œæ¨è
    recommendations = new_recommender.get_user_recommendations(user_id=1001, top_n=5)
```

## é«˜çº§ç”¨æ³•

### 1. è‡ªå®šä¹‰æ¨¡å‹å‚æ•°
```python
# åˆ›å»ºæ¨èç³»ç»Ÿæ—¶è®¾ç½®åµŒå…¥ç»´åº¦
recommender = MySQLRecommendationSystem()
recommender.embedding_dim = 128  # é»˜è®¤64
```

### 2. åˆ†ææ¨èè´¨é‡
```python
# è·å–ç”¨æˆ·çš„å†å²è¡Œä¸º
user_id = 1001
user_history = df[df['user_id'] == user_id]
print(f"ç”¨æˆ· {user_id} çš„å†å²è¯„åˆ†:")
print(user_history[['item_id', 'rating', 'user_type']].head())

# ç”Ÿæˆæ¨è
recommendations = recommender.get_user_recommendations(user_id, top_n=10, df=df)

# åˆ†ææ¨èç»“æœ
print(f"\næ¨èç»“æœ:")
for rec in recommendations:
    print(f"ç‰©å“ {rec['item_id']}: é¢„æµ‹è¯„åˆ† {rec['predicted_rating']:.2f}")
```

### 3. å¤„ç†å†·å¯åŠ¨é—®é¢˜
```python
# æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨äºè®­ç»ƒæ•°æ®ä¸­
def check_user_exists(user_id):
    if user_id in recommender.user_id_to_idx:
        return True
    else:
        print(f"ç”¨æˆ· {user_id} ä¸å­˜åœ¨äºè®­ç»ƒæ•°æ®ä¸­ï¼ˆå†·å¯åŠ¨ç”¨æˆ·ï¼‰")
        return False

# ä¸ºæ–°ç”¨æˆ·æä¾›çƒ­é—¨æ¨è
def get_popular_items(df, top_n=10):
    """è·å–çƒ­é—¨ç‰©å“ä½œä¸ºå†·å¯åŠ¨æ¨è"""
    popular_items = df.groupby('item_id').agg({
        'rating': ['mean', 'count']
    }).round(2)
    popular_items.columns = ['avg_rating', 'rating_count']
    popular_items = popular_items[popular_items['rating_count'] >= 5]  # è‡³å°‘5ä¸ªè¯„åˆ†
    return popular_items.sort_values('avg_rating', ascending=False).head(top_n)
```

## è¾“å‡ºè¯´æ˜

### 1. è®­ç»ƒè¿‡ç¨‹è¾“å‡º
```
ğŸš€ è¿è¡Œå®Œæ•´çš„æ¨èç³»ç»Ÿæµç¨‹
================================================================================
ğŸ“Š ä»MySQLåŠ è½½ç”¨æˆ·è¡Œä¸ºæ•°æ®...
âœ… æˆåŠŸåŠ è½½æ•°æ®: 1000 æ¡è®°å½•
   å”¯ä¸€ç”¨æˆ·æ•°: 100
   å”¯ä¸€ç‰©å“æ•°: 50
   è¯„åˆ†èŒƒå›´: 1.00 - 5.00
   å¹³å‡è¯„åˆ†: 3.45

ğŸ”„ åˆ›å»ºIDæ˜ å°„...
âœ… IDæ˜ å°„åˆ›å»ºå®Œæˆ:
   ç”¨æˆ·æ˜ å°„: 100 ä¸ªç”¨æˆ·
   ç‰©å“æ˜ å°„: 50 ä¸ªç‰©å“

ğŸš€ å¼€å§‹è®­ç»ƒæ¨èæ¨¡å‹...
æ¨¡å‹å‚æ•°:
  ç”¨æˆ·æ•°é‡: 100
  ç‰©å“æ•°é‡: 50
  åµŒå…¥ç»´åº¦: 64
  è®­ç»ƒé›†å¤§å°: 800
  éªŒè¯é›†å¤§å°: 200
  
  Epoch   0: è®­ç»ƒæŸå¤±=2.3451, éªŒè¯æŸå¤±=2.2876
  Epoch  10: è®­ç»ƒæŸå¤±=1.8234, éªŒè¯æŸå¤±=1.7965
  ...
âœ… æ¨¡å‹è®­ç»ƒå®Œæˆ!
```

### 2. æ¨èç»“æœè¾“å‡º
```
ğŸ¯ ä¸ºç”¨æˆ· 1001 (ç´¢å¼•:5) ç”Ÿæˆæ¨è...
   æ’é™¤å·²è¯„åˆ†ç‰©å“: 3 ä¸ª
âœ… ç”Ÿæˆäº† 10 ä¸ªæ¨è

æ¨èç»“æœ:
     1. 2005 - é¢„æµ‹è¯„åˆ†: 4.23
     2. 2012 - é¢„æµ‹è¯„åˆ†: 4.18
     3. 2008 - é¢„æµ‹è¯„åˆ†: 4.15
     ...
```

## å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“è¿æ¥å¤±è´¥
**A**: æ£€æŸ¥æ•°æ®åº“é…ç½®å‚æ•°ï¼Œç¡®ä¿MySQLæœåŠ¡æ­£åœ¨è¿è¡Œï¼Œç”¨æˆ·æœ‰ç›¸åº”æƒé™ã€‚

### Q2: å†…å­˜ä¸è¶³
**A**: å‡å°‘åµŒå…¥ç»´åº¦æˆ–ä½¿ç”¨æ‰¹é‡è®­ç»ƒï¼Œå¤„ç†å¤§è§„æ¨¡æ•°æ®æ—¶è€ƒè™‘æ•°æ®åˆ†ç‰‡ã€‚

### Q3: è®­ç»ƒæ”¶æ•›æ…¢
**A**: è°ƒæ•´å­¦ä¹ ç‡ã€å¢åŠ è®­ç»ƒè½®æ•°æˆ–ä½¿ç”¨ä¸åŒçš„ä¼˜åŒ–å™¨ã€‚

### Q4: æ¨èç»“æœä¸ç†æƒ³
**A**: æ£€æŸ¥æ•°æ®è´¨é‡ã€è°ƒæ•´æ¨¡å‹å‚æ•°æˆ–å¢åŠ è®­ç»ƒæ•°æ®ã€‚

## æ‰©å±•å¼€å‘

### 1. æ·»åŠ æ–°çš„æ¨èç®—æ³•
```python
def create_deep_model(self):
    """åˆ›å»ºæ·±åº¦ç¥ç»ç½‘ç»œæ¨èæ¨¡å‹"""
    class DeepRecommendationModel(nn.Module):
        def __init__(self, num_users, num_items, embedding_dim):
            super().__init__()
            self.user_embedding = nn.Embedding(num_users, embedding_dim)
            self.item_embedding = nn.Embedding(num_items, embedding_dim)
            self.fc = nn.Sequential(
                nn.Linear(embedding_dim * 2, 128),
                nn.ReLU(),
                nn.Linear(128, 64),
                nn.ReLU(),
                nn.Linear(64, 1)
            )
        
        def forward(self, user_ids, item_ids):
            user_emb = self.user_embedding(user_ids)
            item_emb = self.item_embedding(item_ids)
            combined = torch.cat([user_emb, item_emb], dim=1)
            return self.fc(combined).squeeze()
    
    return DeepRecommendationModel(self.num_users, self.num_items, self.embedding_dim)
```

### 2. é›†æˆåˆ°Web API
```python
from flask import Flask, jsonify, request

app = Flask(__name__)
recommender = MySQLRecommendationSystem()

@app.route('/recommend/<int:user_id>')
def get_recommendations(user_id):
    recommendations = recommender.get_user_recommendations(user_id, top_n=10)
    return jsonify(recommendations)

if __name__ == '__main__':
    # åŠ è½½é¢„è®­ç»ƒæ¨¡å‹
    recommender.load_model_and_mappings()
    app.run(debug=True)
```

## æ€»ç»“

è¿™ä¸ªæ¨èç³»ç»Ÿæä¾›äº†å®Œæ•´çš„ä»æ•°æ®åŠ è½½åˆ°æ¨èç”Ÿæˆçš„è§£å†³æ–¹æ¡ˆï¼Œç‰¹åˆ«é€‚åˆå¤„ç†éè¿ç»­IDçš„åœºæ™¯ã€‚é€šè¿‡åˆç†çš„é…ç½®å’Œä½¿ç”¨ï¼Œå¯ä»¥ä¸ºä¸åŒç±»å‹çš„ç”¨æˆ·æä¾›é«˜è´¨é‡çš„ä¸ªæ€§åŒ–æ¨èæœåŠ¡ã€‚

æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒä»£ç ä¸­çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²ã€‚ 